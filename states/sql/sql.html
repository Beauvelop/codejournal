<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?skin=desert"></script>
<div class="sql-container">
  <aside><span class="rot90">{{state}}</span></aside>
  <div class="framed2 w40 dkbg top-right-box wh"><sup class="med ltred">SQL Hotlist</sup>
  <pre>
  <i class="orange">CREATE TABLE</i> <em class="y">Name</em>
  ( personID INT, name varchar(50), hobby varchar(100) );
  <i class="orange">INSERT INTO</i> humans (personID, name, hobby);
  <i class="orange">VALUES</i> (01, 'Sue', 'Drinking');
  <i class="orange">DROP TABLE</i> table_name;
  <i class="orange">ALTER TABLE</i> <em class="y">Name</em> <i class="orange">ADD COLUMN </i><em class="y">col_Name</em>
                                                 <i class="orange">INTEGER REFERENCES</i><em class="y">pets(petID)</em>
  <i class="ltblue">massive.js</i>
  <a class="fRight" target="_blank" href="https://chinook.ml/">Test in CHINOOK</a>
  </pre></div>
  <div class="sql-entry entry">
    <pre>
  <!-- pre for all sql -->

  <div class="squat framed8 w60"><span class="chtitle wh">Common Keywords</span>
    <ul>
      <li><b class="orange">DESC/ASC</b> select age from pets asc limit 3</li>
      <li><b class="orange">LIMIT</b> select * from pets limit 4</li>
      <li><b class="orange">BETWEEN </b>X <b class="orange">AND</b> select * from pets where age between 3 and 5</li>
      <li><b class="orange">SUM()</b> select sum(age) from humans</li>
      <li><b class="orange">AVG()</b> select avg(personID) from humans</li>
      <li><b class="orange">UPPER()</b> SELECT upper(name) FROM humans</li>
      <li><b class="orange">DISTINCT</b> SELECT DISTINCT age FROM humans; -no dupes</li>
      <li><b class="orange">ALTER TABLE</b> ALTER TABLE t_name ADD COLUMN col_name</li>
      <li class="ltgrey">ALTER TABLE Name ADD COLUMN col_Name INTEGER REFERENCES pets(petID) <i class="wh sm">--foreign key</i></li>
      <li class="sm grey"><b class="orange">ALTER TABLE</b> <em class="y">Name</em> <b class="orange">ADD COLUMN </b><em class="y">col_Name</em> <b class="orange">INTEGER REFERENCES</b><em class="y"> pets(petID)</em> <i></i>foreign key: </li>
      <li><b class="orange">ORDER BY</b> SELECT * FROM humans order by age;</li>
      <li><b class="orange">GROUP BY</b> SELECT * FROM humans group by city;</li>
      <li><b class="orange">OFFSET</b> SELECT * FROM humans limit 1 offset 1</li>
      <li><b class="orange">RANDOM()</b> select * from humans order by random() limit 1<sup class="wh">single random record</sup></li>
      <li><b class="orange">UPDATE</b> UPDATE pets SET name = 'Rover' where name='Scooby'</li>
      <li><b class="orange">DELETE</b> FROM pets WHERE kind = 'humans'</li>
      <li><b class="orange">ALTER TABLE </b>ALTER TABLE pets DROP scratch_history</li>
      <li><b class="orange">SELECT current_database();</b> returns name of DB</li>

    </ul>
  </div>

<div class="framed7 col-2"><h3 class="chtitle wh">Sample DB creation</h3>
  <table class="w40">
    <tr>
      <th>PersonID</th>
      <th>name</th>
      <th>city</th>
      <th>age</th>
      <th>food</th>
      <th>hobby</th>
    </tr>
    <tr>
      <td>01</td>
      <td>Sue</td>
      <td>Boston</td>
      <td>28</td>
      <td>Lobster</td>
      <td>Drinking</td>
    </tr>
    <tr>
      <td>02</td>
      <td>Jeff</td>
      <td>Halifax</td>
      <td>64</td>
      <td>Pizza</td>
      <td>Scrabble</td>
    </tr>
    <tr>
      <td>03</td>
      <td>Derrick</td>
      <td>Provo</td>
      <td>50</td>
      <td>Tacos</td>
      <td>Jogging</td>
    </tr>
    <tr>
      <td>04</td>
      <td>Sam</td>
      <td>Dallas</td>
      <td>12</td>
      <td>Burgers</td>
      <td>Nintendo</td>
    </tr>
    <tr>
      <td>05</td>
      <td>Ann</td>
      <td>Rome</td>
      <td>31</td>
      <td>Pasta</td>
      <td>Coding</td>
    </tr>
  </table>
  <hr>

<pre class="prettyprint w40 ">
create table humans (
  personID INT,
  name varchar(50),
  city varchar(100),
  age INT,
  food varchar(100),
  hobby varchar(100)
);

INSERT INTO humans (personID, name, city, age, food, hobby)
VALUES
  (01, 'Sue', 'Boston', 28, 'Lobster', 'Drinking'),
  (02, 'Jeff', 'Halifax', 64, 'Pizza', 'Scrabble'),
  (03, 'Derrick', 'Provo', 50, 'Tacos', 'Jogging'),
  (04, 'Sam', 'Dallas', 12, 'Burgers', 'Nintendo'),
  (05, 'Ann', 'Rome', 31, 'Pasta', 'Coding');
</pre>

  </div>
  <div class="plain-frame1 w60">
"Select humans where food is neither Lobster nor Pizza nor Burgers"

  <table>
      <tr class="sand">
        <th>personID</th>
        <th>name</th>
        <th>city</th>
        <th>age</th>
        <th>food</th>
        <th>hobby</th>
      </tr>
      <tr>
        <td>03</td>
        <td>Derrick</td>
        <td>Provo</td>
        <td>50</td>
        <td>Tacos</td>
        <td>Jogging</td>
      </tr>
      <tr>
        <td>05</td>
        <td>Ann</td>
        <td>Rome</td>
        <td>31</td>
        <td>Pasta</td>
        <td>Coding</td>
      </tr>
    </table>
<pre class="prettyprint w40">select * from humans
    where food not in ('Lobster', 'Pizza', 'Burgers');</pre>
  <i class="dkred med">IN / NOT IN</i> can achieve and "either or/neither nor" logical query.
<br>
"Show records of humans not from Boston or age is not less than 55"
<br><table>
  <tr>
    <th>personID</th>
    <th>name</th>
    <th>city</th>
    <th>age</th>
    <th>food</th>
    <th>hobby</th>
  </tr>
  <tr>
    <td>02</td>
    <td>Jeff</td>
    <td>Halifax</td>
    <td>64</td>
    <td>Pizza</td>
    <td>Scrabble</td>
  </tr>
</table>
<pre class="prettyprint w40">select * from humans
  where not (age < 55 or city like '%osto%');</pre>

  </div>
  <div class="framed6"><h3 class="chtitle wh med">pets DB</h3>
      <table class="w40 bright-table">
        <tr>
          <th>petID</th>
          <th>name</th>
          <th>age</th>
          <th>kind</th>
          <th>sex</th>
          <th>legs</th>
          <th>lbs</th>
        </tr>
        <tr>
          <td>01</td>
          <td>Scruffy</td>
          <td>2</td>
          <td>ferret</td>
          <td>male</td>
          <td>4</td>
          <td>3</td>
        </tr>
        <tr>
          <td>02</td>
          <td>Scooby</td>
          <td>5</td>
          <td>dog</td>
          <td>female</td>
          <td>4</td>
          <td>12</td>
        </tr>
        <tr>
          <td>03</td>
          <td>Mini</td>
          <td>1</td>
          <td>mouse</td>
          <td>male</td>
          <td>4</td>
          <td>1</td>
        </tr>
        <tr>
          <td>04</td>
          <td>Grover</td>
          <td>5</td>
          <td>turtle</td>
          <td>female</td>
          <td>4</td>
          <td>7</td>
        </tr>
        <tr>
          <td>05</td>
          <td>Robin</td>
          <td>4</td>
          <td>bird</td>
          <td>male</td>
          <td>2</td>
          <td>1</td>
        </tr>
      </table>
<pre class="prettyprint w60">
create table pets
(petID int, name varchar(50), age int, kind varchar(50), sex varchar(10), legs int, lbs int);

INSERT INTO pets (petID, name, age, kind, sex, legs, lbs)

VALUES
  (01, 'Scruffy', 2, 'ferret','male', 4, 3),
  (02, 'Scooby', 5, 'dog','female', 4, 12),
  (03, 'Mini', 1, 'mouse','male', 4, 1),
  (04, 'Grover', 5, 'turtle','female', 4, 7),
  (05, 'Robin', 4, 'bird','male', 2, 1);</pre>

<span class="lg wh">"Okay, Give me all records of the youngest pet"</span>

<table class="w40 bright-table">
    <tr>
      <th>petID</th>
      <th>name</th>
      <th>age</th>
      <th>kind</th>
      <th>sex</th>
      <th>legs</th>
      <th>lbs</th>
    </tr>
    <tr>
      <td>03</td>
      <td>Mini</td>
      <td>1</td>
      <td>mouse</td>
      <td>male</td>
      <td>4</td>
      <td>1</td>
    </tr>
  </table>
<pre class="prettyprint w40">select * from pets order by age asc limit 1</pre>
</div>
<div class="col-2 simple-wine-frame">
  <div class="plain-frame1 w40"><h3 class="chtitle mutedBlue">"group by"</h3>
    "Give me number of pets for each gender"

    <table class="bright-table">
        <tr>
          <th>gender</th>
          <th>animals</th>
        </tr>
        <tr>
          <td>female</td>
          <td>2</td>
        </tr>
        <tr>
          <td>male</td>
          <td>3</td>
        </tr>
      </table>
  <pre class="prettyprint sm">
  select sex as gender, count(*) as animals from pets
  group by sex</pre>
  <p>Notice that the 'count(*)' is alias<em>-able</em></p>

  </div>
  <div class="plain-frame2 w40"><h3 class="chtitle mutedBlue">"group by"</h3>
"Among pets that aren't birds (or injured)... Give me a total per each age group."

    <table class="bright-table">
        <tr>
          <th>age</th>
          <th>animals</th>
        </tr>
        <tr>
          <td>5</td>
          <td>2</td>
        </tr>
        <tr>
          <td>2</td>
          <td>1</td>
        </tr>
        <tr>
          <td>1</td>
          <td>1</td>
        </tr>
      </table>
<pre class="prettyprint sm">
  select age, count(*) as animals from pets
  group by age
  having legs > 2
  order by age desc</pre>
<p></p>
  </div>
</div>
<div class="plain-frame3">
  <pre class="prettyprint w60">
    CREATE TABLE users
  (
    user_id SERIAL PRIMARY KEY,
    name VARCHAR(20) NOT NULL,
    username varchar(20) UNIQUE, // 'UNIQUE' here, makes certain that no 2 users have same nickname
    auth0_id TEXT
  );


  INSERT INTO users
  (
    id,
    name,
    username
  )

  VALUES ('Alfred Brown'), // notice that no id is entered. It auto increments.
  ('Leroy mJenkins', 'mJenk20'),
  ('Susan Wilson', 'sxySuzi2000'),
  ('Casey Affleck', 'citizen4'),
  ('Jennifer Lawrence', 'jLo2017'),
  ('Gordon Ramsey', 'michStar3');
</pre>

DROP column_to_be_deleted;
</div>
<div class="dkblue ltbg2">
<h3>Rename table</h3>
<h4 class="black"><i class="orange">ALTER TABLE</i> people <i class="orange">RENAME TO</i> humans</h4>
<h3>Rename column</h3>
<h4 class="black"><i class="orange">ALTER TABLE</i> pets <i class="orange">RENAME COLUMN</i> petID <i class="orange">TO</i> pet_ID;</h4>
<h3>Remove column</h3>
<h4 class="black"><i class="orange">ALTER TABLE</i> pets <i class="orange">DROP</i> petID</h4>
<h3>Join table <em>using aliasing</em></h3>
<h4 class="black"><i class="orange">SELECT</i> * from people h <i class="orange">JOIN</i> pets p <i class="orange">ON</i> p.petid = h.personid;</h4>
<h3>Drop table (with dependents)</h3>
<h4 class="black"><i class="orange">DROP TABLE</i> spammers <i class="orange">CASCADE</i> </h4>
</div>
<hr>
<div class="framed5">
  <h3>About massive.js & the connectionString</h3>
<pre class="prettyprint w60">var db = massive.connectSync({
   connectionString: '<span class="sand">postgres</span>:<span class="ltblue">//localhost</span><span class="orange">/superDatabase</span>' NOTE: '(1)://(2)/(3)'
});</pre>

<span class="sand">postgres</span> --kind of db
<span class="ltblue">//localhost</span>-- can be 127.0.0.1 or (if remote server) enter ip address
or 'db.myfunapp.com' (it's just a DNS or ip link)
<span class="orange">/superDatabase</span> is the db to connect to --can be '/anyDBname' to connect to

IMPORTANT: IF YOU HAVE A USERNAME AND PASSWORD,  FORMAT IS:
'postgres://user:pass@localhost/massive-demo'
or... if no PASSWORD: 'postgres://user:@localhost/massive-demo'
(often it is your machine connecting to postgres)
THEREFORE: Don't be putting this stuff up on a repo, okay?
rather use an env variable passed in or some kind of config.
</div>
<div class="plain-frame"><h3>first lines of server.js file <span class="sm pastpink">(node.js/massive.js)</span></h3>
<pre class="prettyprint">var express = require('express');
var bodyParser = require('body-parser');
var massive = require('massive');
var app = express();
app.use(bodyParser.json());

var db = massive.connectSync({
  connectionString: 'postgres://mpulbuktczhfzj:e6fde394142c2e006b44b3352ba334b104de2410ea4613a13138f4f22635339c@ec2-174-129-224-33.compute-1.amazonaws.com:5432/d23c4pa0029vls?ssl=true'
});
// autogenerated heroku DB NAME: d23c4pa0029vls
</pre>
<h3>A sample GET</h3>
<div class="col-2"><b class="fuch">A. </b>Simplest way is this:
<pre class="prettyprint w40">app.get('/humans', logQuery, function(req, res) {
  db.get_humans(function(err, humans) {
   res.send(humans);
 })
});</pre><b class="fuch">B </b>But, the convention is to put it on a property of an object thus:
<pre class="prettyprint w40">app.get('/humans', logQuery, function(req, res) {
  db.get_humans(function(err, humans) {
   res.send({humans:humans});
  })
});</pre></div>
<b class="fuch">A </b>Yields:
<pre class="w60 simple-frame sm">
[   {"personid":1,"name":"Sue","city":"Boston","age":28,"food":"Lobster","hobby":"Drinking"},
    {"personid":2,"name":"Jeff","city":"Halifax","age":64,"food":"Pizza","hobby":"Scrabble"},
    {...}  ]</pre>
<b class="fuch">B. </b>Yields:
<pre class="w60 simple-frame sm">
{
  "humans":[
                {"personid":1,"name":"Sue","city":"Boston","age":28,"food":"Lobster","hobby":"Drinking"},
                {"personid":2,"name":"Jeff","city":"Halifax","age":64,"food":"Pizza","hobby":"Scrabble"},
                {...}
           ]
}</pre>
<div class="ctr ltbg2 w50"><p>It's important to know why this convention exists.</p>
<div class="txtLeft">returning a simple array will prevent inserting info along with the response.
  <pre class="prettyprint w20">res.send(humans);</pre></p>
Whereas, with an object <pre class="prettyprint w20">res.send(humans);</pre>
I can now insert stuff: <pre class="prettyprint">app.get('/petsandowners', logQuery, function(req, res) {
  db.get_pets_and_owners(function(err, response) {
   res.send({
     response_description: "Collection of pets and their owners",
     data: response});
 })
});</pre>
<pre class="w40 simple-frame sm">{
  "response_description":"Collection of pets and their owners",
  "data":[
      {"petname":"Scruffy","owner":"Sue"},
      {"petname":"Scooby","owner":"Jeff"},
      {"petname":"Mini","owner":"Derrick"},
      {"petname":"Grover","owner":"Sam"},
      {"petname":"Robin","owner":"Ann"}
    ]
}</pre>
</div>
</div>
</div>
  </pre>
  <!-- end of pre for all -->
</div>
<!-- end of entry -->

</div>
<!-- end of sql container -->
